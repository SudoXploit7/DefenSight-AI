<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DefenSight AI ‚Äì {{ title or "Dashboard" }}</title>
  
  <!-- Bootstrap + Styles -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <style>
    #loader-overlay {
      position: fixed;
      z-index: 9999;
      background-color: rgba(255, 255, 255, 0.96);
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .loading-dots::after {
      content: '';
      display: inline-block;
      width: 1em;
      height: 1em;
      border-radius: 50%;
      background: currentColor;
      animation: blink 1s infinite ease-in-out alternate;
    }

    @keyframes blink {
      0% { opacity: 0.2; }
      100% { opacity: 1; }
    }
  </style>
  {% block head %}{% endblock %}
</head>
<body class="bg-light" onload="hideLoader()">

<!-- üîÑ Page Loading Overlay -->
<div id="loader-overlay">
  <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
  <p class="mt-3 fw-semibold text-secondary">Generating detailed summaries using DefenSight AI...</p>
</div>

<!-- üîç Main Page Content -->
<div class="container py-4" id="main-content" style="display: none;">
  <h2 class="mb-4 text-primary fw-bold">üõ°Ô∏è DefenSight AI Dashboard</h2>
  {% block content %}{% endblock %}
</div>

<!-- üí¨ Assistant Floating Button -->
<div id="chat-button" onclick="toggleChat()">üí¨</div>

<!-- üß† Assistant Chat Box -->
<div id="chat-box" class="card shadow" style="display:none">
  <div class="card-header bg-primary text-white">Assistant</div>
  <div class="card-body" id="chat-messages" style="max-height: 250px; overflow-y: auto;"></div>
  <input class="form-control mt-2" id="user-input" placeholder="Ask something..." onkeydown="if(event.key==='Enter') sendChat()" />
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="{{ url_for('static', filename='assistant.js') }}"></script>
<script>
  function hideLoader() {
    document.getElementById('loader-overlay').style.display = 'none';
    document.getElementById('main-content').style.display = 'block';
  }
</script>
{% block scripts %}{% endblock %}
</body>
</html>
